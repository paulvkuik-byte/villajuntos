{% extends "base.html" %}
{% block content %}
<section class="section">
  <div class="container">
    <h1 class="title is-3">{{ t('avail_title') }}</h1>
    <div class="columns">
      <div class="column is-two-thirds">
        <div id="calendar" class="box"></div>
      </div>
      <div class="column">
        <div class="box">
          {% if current_user.is_authenticated %}
          <form method="post" action="{{ url_for('book') }}" id="bookingForm">
            <div class="field">
              <label class="label">Startdatum</label>
              <input class="input" type="date" name="start_date" id="start_date" required>
            </div>
            <div class="field">
              <label class="label">Einddatum</label>
              <input class="input" type="date" name="end_date" id="end_date" required>
            </div>
            <div class="field">
              <label class="label">Opmerking (optioneel)</label>
              <textarea class="textarea" name="note"></textarea>
            </div>
            <p class="is-size-7 mb-2">Regels: max <strong>{{ config.MAX_NIGHTS_PER_MONTH }}</strong> nachten p/m; max <strong>{{ config.ADVANCE_BOOKING_MONTHS }}</strong> maanden vooruit.</p>
            <button class="button is-primary" type="submit">Aanvraag indienen</button>
          </form>
          {% else %}
          <p>Log in of registreer om te reserveren.</p>
          <div class="buttons mt-3">
            <a class="button is-light" href="{{ url_for('login') }}">Inloggen</a>
            <a class="button is-primary" href="{{ url_for('register') }}">Registreren</a>
          </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</section>
<script>
document.addEventListener('DOMContentLoaded', function() {
  var calendarEl = document.getElementById('calendar');
  var calendar = new FullCalendar.Calendar(calendarEl, {
    initialView: 'dayGridMonth',
    firstDay: 1,
    selectable: true,
    height: 'auto',
    events: '{{ url_for('calendar_feed') }}',
    select: function(info) {
      var end = new Date(info.end);
      end.setDate(end.getDate() - 1);
      var s = document.getElementById('start_date');
      var e = document.getElementById('end_date');
      if (s && e){
        s.value = info.startStr;
        e.value = end.toISOString().slice(0,10);
        document.getElementById('bookingForm').scrollIntoView({behavior:'smooth'});
      }
    }
  });
  calendar.render();
});
</script>
{% endblock %}
